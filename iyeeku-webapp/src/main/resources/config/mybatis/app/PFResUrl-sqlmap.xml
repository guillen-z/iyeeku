<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iyeeku.ext.function.dao.PFResUrlDao">

	<resultMap id="BaseResultMap" type="com.iyeeku.ext.function.vo.PFResUrlVO" >
		<id column="URLBH" property="urlbh" jdbcType="CHAR" />
		<result column="URLBM" property="urlbm" jdbcType="VARCHAR" />
		<result column="URLLJ" property="urllj" jdbcType="VARCHAR" />
		<result column="URLMS" property="urlms" jdbcType="VARCHAR" />
		<result column="URLLX" property="urllx" jdbcType="CHAR" />
	</resultMap>

	<select id="findAllUrls" resultMap="BaseResultMap">
		SELECT URLBH, URLBM, URLLJ, URLMS, URLLX FROM PF_RESURL
	</select>

	<select id="findNotMenuUrl" parameterType="java.util.Map" resultMap="BaseResultMap">
		SELECT URLBH, URLBM, URLLJ, URLMS, URLLX FROM PF_RESURL
		WHERE URLLJ NOT IN (SELECT CDURL FROM PF_RESMENU WHERE CDURL IS NOT NULL)
		AND URLBH NOT IN (SELECT URLBH FROM PF_RESURL WHERE URLLJ LIKE '%/**/*')
		<if test="key != null"> AND URLLJ LIKE #{key}</if>
		ORDER BY URLLJ ASC
	</select>

	<insert id="addUrl" parameterType="com.iyeeku.ext.function.vo.PFResUrlVO">
		insert into PF_RESURL (URLBH, URLBM, URLLJ,
		URLMS, URLLX)
		values (#{urlbh,jdbcType=CHAR}, #{urlbm,jdbcType=VARCHAR}, #{urllj,jdbcType=VARCHAR},
		#{urlms,jdbcType=VARCHAR}, #{urllx,jdbcType=CHAR})
	</insert>

	<update id="updateUrlByLj" parameterType="com.iyeeku.ext.function.vo.PFResUrlVO">
		UPDATE PF_RESURL
		<set>
			URLBM=#{urlbm,jdbcType=VARCHAR}, URLMS=#{urlms,jdbcType=VARCHAR}
		</set>
		WHERE URLLJ=#{urllj,jdbcType=VARCHAR} AND URLLX=#{urllx,jdbcType=CHAR}
	</update>

	<delete id="deleteUrlByLj" parameterType="com.iyeeku.ext.function.vo.PFResUrlVO">
		DELETE FROM PF_RESURL WHERE URLLJ=#{urllj,jdbcType=VARCHAR} AND URLLX=#{urllx,jdbcType=CHAR}
	</delete>

	<!-- 获取模块的URL信息和模块关联的url -->
	<select id="findMKRelationUrl" resultMap="BaseResultMap" parameterType="java.util.HashMap">
		select * from PF_RESURL
		WHERE URLLJ like #{ssmkLj}
		OR URLBH in (select cdxbm from PF_RESRELATION
			WHERE ZDXBM = (select CDBH FROM PF_RESMENU WHERE CDURL = #{cdurl})
			AND ZDXLX = #{zdxlx} AND CDXLX = 'LJ')
		ORDER BY URLLJ
	</select>


</mapper>